<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Grid</title>
    <link rel="stylesheet" href="static/styles.css">
    <link href="https://cdn.rawgit.com/noelboss/featherlight/1.4.1/release/featherlight.min.css" type="text/css">
</head>
<body>
<nav class="navbar navbar-light bg-faded">
    <span class="navbar-brand">Page {{ page_num }} of {{ page_count }}</span>
    <div class="pull-xs-right">
        <div class="nav-item">{{ '{:,d} total images'.format(total_image_count) }}</div>
    </div>
</nav>
<div class="container-fluid">
    {% for grid in grids %}
    <h4>{{first_grid_id + loop.index}} : {{ grid.grid_id }} {{ grid.info_text }}</h4>
    <div class="row imgrid-row">
        {% for image in grid.images %}
        {% if images_per_row == 6 %}
        <div class="col-xs-6 col-sm-4 col-md-3 col-lg-2 thumb">
        {% elif images_per_row == 4 %}
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-3 thumb">
        {% elif images_per_row == 3 %}
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-4 thumb">
        {% endif %}
            <a href="{{ image.href }}" data-featherlite="image" class="thumbnail">
                <figure>
                    <img alt="{{ image.text }}" src="{{ image.href_thumb }}">
                    <figcaption class="figure-caption">
                        {{ image.fname }}
                        {% if 'part_score' in image %}
                        <br>
                        Part: {{ '%.3f' % image.part_score }}
                        <br>
                        RR: {{ '%.3f' % image.rr_score }}
                        {% endif %}
                        {% if labels %}
                        <br>
                        <div class="btn-group" data-toggle="buttons">
                            {% for label in labels %}
                            <label class="btn btn-secondary-outline btn-sm label-toggle" data-fname="{{ image.href }}" data-label="{{ label }}">
                                <input type="checkbox" autocomplete="off">{{ label }}
                            </label>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </figcaption>
                </figure>
            </a>
        </div>
        {% endfor %}
        <!-- other images... -->
    </div>
    {% endfor %}
</div>

<nav>
    <ul class="pager">
        {% if page_num > 1 %}
        <li><a href="/{{page_num-1}}">Previous</a></li>
        {% else %}
        <li class="disabled"><a href="javascript: void(0)">Previous</a></li>
        {% endif %}
        {% if page_num < page_count %}
        <li><a href="/{{page_num+1}}">Next</a></li>
        {% else %}
        <li class="disabled"><a href="javascript: void(0)">Next</a></li>
        {% endif %}
    </ul>
</nav>

<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdn.rawgit.com/noelboss/featherlight/1.4.1/release/featherlight.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/js/bootstrap.min.js" integrity="sha384-vZ2WRJMwsjRMW/8U7i6PWi6AlO1L79snBrmgiDpgIWJ82z8eA5lenwvxbMV1PAh7" crossorigin="anonymous"></script>

{% if labels %}
<script>
 $(document).ready(function() {
   $('.label-toggle').change(function() {
     var $label = $(this);
     var fname = $label.data('fname');
     var label = $label.data('label');
     
     var isActiveBeforeToggle = $label.hasClass('active');
     if (isActiveBeforeToggle) {
       // entering unchecked state
       console.log('unchecked: ' + fname + ', ' + label);
     } else {
       // entering checked state
       console.log('checked: ' + fname + ', ' + label);
     }

     $.ajax ({
       url: '/set_label',
       type: 'POST',
       data: JSON.stringify({
         path: fname,
         label: label,
         add: !isActiveBeforeToggle
       }),
       contentType: "application/json;charset=utf-8"
     }).success(function() {
       console.log('Successfully updated label ' + label + ' for ' + fname);
     }).fail(function(x) {
       alert('Error occurred when setting label');
       console.log(x);
       // reset
       if (isActiveBeforeToggle) {
         $label.addClass('active');
       } else {
         $label.removeClass('active');
       }
     });

   });
 });
</script>
{% endif %}

</body>
</html>
